#!/bin/bash
in=$1
pdftk $1 burst

ph=`cat doc_data.txt  | grep PageMediaDimensions | head -1 | awk '{print $2}'`
pw=`cat doc_data.txt  | grep PageMediaDimensions | head -1 | awk '{print $3}'`
w2=$(( pw / 2 ))
w2px=$(( w2*10 ))
hpx=$((  ph*10 ))
for f in  pg_[0-9]*.pdf ; do
 lf=left_$f
 rf=right_$f
 gs -o ${lf} -sDEVICE=pdfwrite -g${w2px}x${hpx} -c "<</PageOffset [0 0]>> setpagedevice" -f ${f}
 gs -o ${rf} -sDEVICE=pdfwrite -g${w2px}x${hpx} -c "<</PageOffset [-${w2} 0]>> setpagedevice" -f ${f}
done

ls -1 [lr]*_[0-9]*pdf | sort -n -k3 -t_ > fl
pdftk `cat fl`  cat output newfile.pdf

rm [lr]*
rm pg*
rm doc*
rm fl

pdf2djvu newfile.pdf -o newfile.djvu
